(()=>{const e="http://localhost:8000/api/v1";async function t(){const e=await new Promise((e=>{chrome.storage.local.get("authToken",(t=>{e(t)}))}));return e.authToken?decodeURIComponent(e.authToken):null}function n(e){let t=e.querySelector(".display-flex.mlA");null===t&&(t=e.querySelector(".display-flex.justify-space-between")),t.style.display="flex",t.style.alignItems="center";const n=document.createElement("img");n.id="stop-button",n.src="https://pic.onlinewebfonts.com/thumbnails/icons_182193.svg",t&&t.insertAdjacentElement("afterBegin",n)}function o(e,t,n){let o=n.querySelector(".display-flex.mlA");null===o&&(o=n.querySelector(".display-flex.justify-space-between"));const r=document.createElement("button");r.id="regenerate-button",r.textContent="Regenerate",n.querySelector("#remove-comment-options"),o&&!e&&o.insertAdjacentElement("afterBegin",r),t&&t.remove()}function r(e,t,n){const r=n.querySelector("#regenerate-button"),a=n.querySelector("#stop-button");var i,c=e.split(""),s=0;!function e(){s<c.length?(t.textContent+=c[s],s++,i=setTimeout(e,20)):s===c.length&&(a&&a.remove(),o(r,a,n))}(),a.addEventListener("click",(function(){clearTimeout(i),o(r,a,n)}))}function a(){const n=document.querySelector("#post-regenerate-button"),o=document.querySelector("#readd-postoptions");n&&n.remove(),o&&o.remove();const r=document.querySelector(".share-box"),c=r.querySelector(".share-creation-state__text-editor.share-creation-state__text-editor-redesigned"),s=r.querySelector(".artdeco-carousel__content");if(c){const n=r.querySelector(".ql-editor");n.blur(),n.textContent="",n.setAttribute("data-placeholder"," "),n.setAttribute("aria-placeholder"," ");const o=c.parentElement.querySelector("#generatePostButton"),l=c.parentElement.querySelector("#postTyzpeInput"),d=c.parentElement.querySelector("#AIpostoptions"),m=c.parentElement.querySelector("#postToneDropdown");if(!(o||l||d||m)){c.style.minHeight="0rem";const n=document.createElement("div"),o=document.createElement("div"),l=document.createElement("textarea"),d=document.createElement("select"),m=document.createElement("select"),u=document.createElement("button"),p=document.createElement("img");l.id="postTypeInput",d.id="postToneDropdown",u.id="generatePostButton",m.id="AIpostoptions",o.id="dropdowndiv",n.id="post-containerDiv",p.id="remove-post-options",p.src="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-close-1024.png",p.alt="remove-post-options",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="flex-start",s.prepend(p),p.addEventListener("click",i),u.textContent="Generate Post",l.placeholder="Briefly describe about the topic of the post";const y=["gemini","chatgpt"];["friendly","funny","short","formal","announcement","serious","position Update","experience"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),d.appendChild(t)})),y.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),m.appendChild(t)})),o.appendChild(d),o.appendChild(m),n.appendChild(l),n.appendChild(o),n.appendChild(u),c.parentElement.appendChild(n),u.addEventListener("click",(async()=>{if(""===l.value||null===l.value)return void alert("Please enter the description for the post");const o=l.value.trim(),i=d.value.trim(),c=m.value;n.textContent="",u&&u.remove();const s=n.querySelector("#commentOptions");s&&s.remove();const p=n.querySelector("#postToneDropdown");p&&p.remove(),await async function(n,o,r,i,c){const s=document.createElement("button");s.textContent="Regenerate",s.id="post-regenerate-button";const l=c.querySelector("#remove-post-options");l&&l.remove();const d=c.querySelector(".ql-editor"),m=c.querySelector(".artdeco-carousel__heading");m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="flex-start";const u=document.createElement("div");u.style.color="#000",u.textContent="Analysing Your Requirements...",u.classList.add("comment-message"),u.classList.add("comment-message-blink");const p=document.createElement("style");p.textContent="\n  .comment-message {\n    animation: blink-animation 1.5s infinite;\n  }\n\n  @keyframes blink-animation {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }\n  ",document.head.appendChild(p),i.appendChild(u),u.textContent="Generating Post Content...";const y=await t();if(!y)return void(u.textContent="User not authenticated, Reload and try again!!");const g=`${e}/ai/generate${r}postcontent`;try{const e=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${y}`},body:JSON.stringify({postType:n,selectedTone:o})});403===e.status&&alert("Credits Exhausted!");const t=(await e.json()).generatedPostContent,r=document.querySelector(".editor-content.ql-container");u.remove(),r.querySelector(".ql-editor p").textContent=t,d.focus(),m.prepend(s),s.addEventListener("click",a)}catch(e){u.textContent=e}}(o,i,c,n,r)}))}}}function i(){const e=document.querySelector(".share-creation-state__text-editor.share-creation-state__text-editor-redesigned"),t=e.parentElement.querySelector(".ql-editor"),n=e.parentElement.querySelector("#generatePostButton"),o=e.parentElement.querySelector("#post-regenerate-button"),r=document.querySelector(".artdeco-carousel__content"),i=document.querySelector("#remove-post-options"),c=e.parentElement.querySelector("#postTypeInput"),s=e.parentElement.querySelector("#AIpostoptions"),l=e.parentElement.querySelector("#postToneDropdown");n&&n.remove(),c&&c.remove(),s&&s.remove(),l&&l.remove(),o&&o.remove(),i&&i.remove(),t&&t.focus(),r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="flex-start";const d=document.createElement("button");d.textContent="Write with AI",d.id="readd-postoptions",d.addEventListener("click",a),r.prepend(d)}function c(){const n=document.querySelector("#message-options"),o=document.querySelector("#new-conversation-options-div"),r=document.querySelector("#remove-new-conversation-options"),a=localStorage.getItem("name");if(o&&o.remove(),r&&r.remove(),!n){const n=document.createElement("div");n.id="message-options";const o=document.createElement("button");o.textContent="Generate Reply",o.id="generate-message-reply",o.addEventListener("click",(function(){const n=document.querySelector(".msg-form__contenteditable"),o=function(){const e=document.querySelector(".msg-s-message-list-content").querySelectorAll(".msg-s-message-list__event");let t=[];if(e&&0!==e.length){for(let n=Math.max(e.length-5,0);n<e.length;n++){const o=e[n],r=o.querySelector(".msg-s-message-group__name")?.textContent.trim(),a=o.querySelector(".msg-s-event-listitem__body")?.textContent.trim(),i=n===e.length-1?"Unknown":e[n+1].querySelector(".msg-s-message-group__name")?.textContent.trim();r&&a&&t.push({sender:r,message:a,receiver:i})}return t.reverse()}alert("No conversation found.")}();0===o.length&&alert("No conversation found."),async function(n,o,r){n.innerHTML="",n.setAttribute("aria-label","");const a=document.querySelector(".msg-form__placeholder");a&&a.setAttribute("data-placeholder","");const i=document.createElement("style");i.textContent="\n  .template-message {\n    animation: blink-animation 1.5s infinite;\n  }\n\n  @keyframes blink-animation {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }\n",document.head.appendChild(i);const c=document.createElement("div");c.style.color="#000",c.textContent="Reading Conversation...",c.classList.add("template-message"),c.classList.add("template-message-blink"),n.appendChild(c);const s=await t();if(!s)return c.textContent="User not Authenticated! Move to feed, Reload and try again",sendResponse({authenticated:!1});const l=`${e}/ai/generatechatgptreply`;try{const e=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${s}`},body:JSON.stringify({formattedMessages:o,userName:r})});if(403===e.status)return c.textContent="Credits Exhausted!",void alert("Credits Exhausted!!");const t=(await e.json()).generatedReply,a=document.createElement("p");n.appendChild(a),c.remove(),t?(c.remove(),n.style.whiteSpace="pre-line",d=a,m=t.split(""),u=0,function e(){u<m.length?(d.textContent+=m[u],u++,animationTimeout=setTimeout(e,20)):m.length}()):c.textContent="Error Generating Reply! Reload and try again"}catch(e){c.textContent=e}var d,m,u}(n,o.map((e=>`${e.sender} : ${e.message}`)).join("\n"),a)}));const r=document.createElement("button");r.textContent="New Conversation",r.id="start-new-conversation",n.appendChild(o),n.appendChild(r);const i=document.querySelector(".msg-form__msg-content-container");i.insertAdjacentElement("afterend",n),r.addEventListener("click",(function(){n.remove();const e=s();i.insertAdjacentElement("afterend",e)}))}}function s(){const n=document.querySelector("#remove-new-conversation-options");n&&n.remove();const o=document.querySelector(".msg-form__placeholder");o&&o.setAttribute("data-placeholder","");const r=document.createElement("div"),a=document.createElement("select"),i=document.createElement("select"),l=document.createElement("button"),d=document.createElement("img"),m=document.createElement("button");m.id="regenerate-messsage-button",d.id="remove-new-conversation-options",d.src="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-close-1024.png",d.classList.add("remove-options-button"),r.id="new-conversation-options-div",a.id="templateRequirements",i.id="templateToneDropdown",l.id="generateTemplateButton",l.textContent="Generate",m.textContent="Regenerate",["Referral Request","Job Application","General Networking","Informational Meeting Request","Business Collaboration","Mentorship Request","Feedback or Advice Request"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),a.appendChild(t)})),["professional","friendly","Formal","Funny","Creative"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),i.appendChild(t)}));const u=document.querySelector(".msg-form__left-actions");return u.style.alignItems="center",u.appendChild(d),r.appendChild(a),r.appendChild(i),r.appendChild(l),d.addEventListener("click",(function(){c()})),l.addEventListener("click",(async()=>{const n=a.value.trim(),o=i.value.trim(),c=document.querySelector(".msg-form__contenteditable");d.classList.add("rotate-animation"),a.remove(),i.remove(),l.remove(),await async function(n,o,r,a,i){r.innerHTML="",r.setAttribute("aria-label","");const c=document.querySelector(".msg-form__placeholder");c&&c.setAttribute("data-placeholder","");const s=document.createElement("style");s.textContent="\n  .template-message {\n    animation: blink-animation 1.5s infinite;\n  }\n\n  @keyframes blink-animation {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }\n",document.head.appendChild(s);const l=document.createElement("div");l.style.color="#000",l.textContent="Analysing Your Requirements...",l.classList.add("template-message"),l.classList.add("template-message-blink"),r.appendChild(l),l.textContent="Generating Template...";const d=await t();if(!d)return l.textContent="User not Authenticated! Move to feed, Reload and try again",sendResponse({authenticated:!1});const m=`${e}/ai/generatechatgpttemplate`;try{const e=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${d}`},body:JSON.stringify({templateRequirements:n,selectedTone:o})});if(403===e.status)return l.textContent="Credits Exhausted!",void alert("Insufficient Credits!!");const t=(await e.json()).generatedTemplateContent,c=document.createElement("p");r.appendChild(c),l.remove(),t?(l.remove(),r.style.whiteSpace="pre-line",function(e,t,n,o){var r=e.split(""),a=0;!function e(){a<r.length?(t.textContent+=r[a],a++,animationTimeout=setTimeout(e,20)):a===r.length&&n.appendChild(o)}()}(t,c,a,i)):l.textContent="Error Generating Message Template!! Reload and try again"}catch(e){l.textContent=e}}(n,o,c,r,m)})),m.addEventListener("click",(function(){m.remove();const e=document.querySelector(".msg-form__msg-content-container"),t=s();e.insertAdjacentElement("afterend",t)})),r}chrome.runtime.onMessage.addListener((function(e,t,n){"checkLinkedInUrl"===e.action&&n({isLinkedIn:window.location.href.includes("linkedin.com")})})),chrome.runtime.onMessage.addListener((function(e,t,n){"callAddDashboardFunction"===e.action&&c()})),chrome.runtime.onMessage.addListener((function(e,t,n){"checkLinkedInFeedUrl"===e.action&&n({isLinkedInFeed:window.location.href.includes("linkedin.com/feed/")})})),document.addEventListener("click",(function(o){const a=o.target;if(a.classList.contains("comments-comment-box__submit-button")||a.classList.contains("artdeco-button__text")){const e=a.closest(".feed-shared-update-v2.feed-shared-update-v2--minimal-padding.full-height.relative").querySelector("#regenerate-button");e&&e.remove()}(a.classList.contains("comment-button")||a.closest("button.comment-button")||a.id.includes("regenerate-button"))&&function(o){const a=o.closest(".feed-shared-update-v2.feed-shared-update-v2--minimal-padding.full-height.relative");if(a){const c=a.querySelector(".comments-comment-box-comment__text-editor"),s=a.querySelector(".ql-editor"),l=a.querySelector(".update-components-text span.break-words");let d=a.querySelector(".display-flex.mlA");null===d&&(d=a.querySelector(".display-flex.justify-space-between"));const m=a.querySelector("#custom-tone-input"),u=a.querySelector("#word-count-input"),p=c.querySelector("#generateButton"),y=c.querySelector("#AIoptions"),g=c.querySelector("#commentOptions"),h=a.querySelector("#stop-button"),f=a.querySelector("#regenerate-button");if(!(m||u||h||p||g||y)){f&&f.remove();const v=document.createElement("button"),C=document.createElement("select"),S=document.createElement("select"),q=document.createElement("img");q.id="remove-comment-options",C.id="commentOptions",S.id="AIoptions",v.id="generateButton",q.src="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-close-1024.png",q.alt="remove-options",S.style.width="140px",C.style.width="120px",o.id.includes("regenerate-button")?v.textContent="Regenerate":v.textContent="Generate",["friendly","funny","disagree","congratulate","question","custom"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),C.appendChild(t)})),["gemini","chatgpt"].forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),S.appendChild(t)}));let x=a.querySelector(".display-flex.mlA");if(null===x&&(x=a.querySelector(".display-flex.justify-space-between")),x.style.display="flex",x.style.justifyContent="space-around",d.style.margin="0px 8px 0px 8px",x.style.alignItems="center",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="flex-start",a.style.alignItems="center",!h){s.textContent=" ",s.setAttribute("data-placeholder"," "),s.setAttribute("aria-placeholder"," "),c.appendChild(S),c.appendChild(C),c.appendChild(v),d.prepend(q);const b=a.querySelector(".ql-editor");function i(){const i=localStorage.getItem("isCommentGenerating"),s=l;if("false"===i&&s){const i=C.value,l=S.value,d=a.querySelector("#remove-comment-options"),m=s.textContent.trim();c.removeChild(C),c.removeChild(S),c.removeChild(v),d.remove(),n(a),localStorage.setItem("isCommentGenerating",!0),async function(n,o,a,i,c,s){const l=document.createElement("div");a.appendChild(l);const d=await t();if(!d)return void(l.textContent="User not authenticated reload and try again!!");document.querySelector(".ql-editor").textContent=" ",l.id="processing-message",s.id?.includes("regenerate-button")?l.textContent="Regenerating Comment...":l.textContent="Generating Comment...";const m=`${e}/ai/generate${c}comment`;try{const e=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${d}`},body:JSON.stringify({postContent:o,selectedOption:i})});if(405===e.status)return void alert("Comment Generation in progress please wait");403===e.status&&(l.textContent="Credits Exhausted!"),e.ok||403==e.status||(l.textContent="Something went wrong, please reload and try again!!");const t=(await e.json()).generatedComment,c=a.querySelector(".ql-editor p");t&&(l.remove(),r(t,c,n)),localStorage.setItem("isCommentGenerating",!1)}catch(e){localStorage.setItem("isCommentGenerating",!1),l.textContent="Something went wrong, please reload and try again!!"}}(a,m,c,i,l,o)}"true"===i&&alert("Comment Generation in Progress Please Wait")}b&&b.blur(),v.addEventListener("click",i),q.addEventListener("click",(function(){const e=a.querySelector("#generateButton"),t=a.querySelector("#commentOptions"),n=a.querySelector("#AIoptions"),o=a.querySelector("#word-count-input"),r=a.querySelector("#custom-tone-input"),i=a.querySelector("#remove-comment-options");i&&i.remove(),e&&e.remove(),t&&t.remove(),n&&n.remove(),o&&o.remove(),r&&r.remove();const c=a.querySelector(".ql-editor");c&&c.focus()})),C.addEventListener("change",(function(){if("custom"===C.value){S&&C.remove();const s=S.value;if(!m&&!u){const d=document.createElement("input"),m=document.createElement("input");m.id="word-count-input",d.id="custom-tone-input",m.type="number",m.placeholder="Word Count",d.placeholder="Custom Tone",c.insertBefore(m,c.firstChild),c.insertBefore(d,c.firstChild),v.style.margin="4px 4px 4px 4px",c.style.flexWrap="wrap",m.style.width="120px",S.style.width="100px",d.style.width="170px",v.removeEventListener("click",i),v.addEventListener("click",(async()=>{q&&q.remove();const i=l,u=localStorage.getItem("isCommentGenerating");if("true"===u&&alert("Comment Generation in Progress Please Wait"),"false"===u&&i){const l=d.value,u=m.value;if(!l)return void alert("Please specify the tone for the comment");if(!u)return void alert("Please specify the word count");const p=i.textContent.trim();c.removeChild(d),c.removeChild(m),c.removeChild(v),c.removeChild(S),n(a),localStorage.setItem("isCommentGenerating",!0),await async function(n,o,a,i,c,s,l){const d=document.createElement("div");a.appendChild(d);const m=await t();if(!m)return void(d.textContent="User not authenticated reload and try again!!");document.querySelector(".ql-editor").textContent=" ",d.id="processing-message",i.id.includes("regenerate-button")?d.textContent="Regenerating Comment...":d.textContent="Generating Comment...";const u=`${e}/ai/generatecustom${c}comment`;try{const e=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${m}`},body:JSON.stringify({postContent:o,customTone:s,wordCount:l})});403===e.status&&(d.textContent="Credits Exhausted!"),e.ok||403==e.status||(d.textContent="Something went wrong, please reload and try again.");const t=(await e.json()).generatedComment,i=a.querySelector(".ql-editor p");d.remove(),r(t,i,n),localStorage.setItem("isCommentGenerating",!1)}catch(e){localStorage.setItem("isCommentGenerating",!1),d.textContent="Something went wrong, please reload and try again."}}(a,p,c,o,s,l,u)}}))}}}))}}}}(a),a.closest(".share-box-feed-entry__top-bar")&&setTimeout((function(){i()}),3e3);const s=document.querySelector(".global-nav__primary-link"),l=document.querySelector(".msg-overlay-list-bubble__convo-card-container");(a===s||a===l||a.closest(".msg-conversation-card__content--selectable")||a.closest(".global-nav__primary-link"))&&setTimeout((function(){c()}),3e3)})),localStorage.setItem("isCommentGenerating",!1),chrome.runtime.onMessage.addListener((function(e,t,n){if("checkForElement"===e.action){const e=document.querySelector(".ember-view.block"),t=e.querySelector(".t-16.t-black.t-bold");if(e&&t){const e=t.textContent.trim();chrome.runtime.sendMessage({action:"elementFound",element:e})}else chrome.runtime.sendMessage({action:"elementNotFound"})}})),chrome.runtime.onMessage.addListener((function(e,t,n){if("loggedoutAlert"===e.action){alert("Logged Out Successfully");const e=document.querySelectorAll(".comments-comment-box-comment__text-editor"),t=document.querySelector(".share-creation-state__text-editor .editor-content .ql-editor"),n=document.querySelector(".msg-form__contenteditable");e&&document.querySelectorAll(".comments-comment-box-comment__text-editor").forEach((e=>{const t=e.querySelector("#generateButton"),n=e.querySelector("#commentOptions"),o=e.querySelector("#AIoptions"),r=e.querySelector("#word-count-input"),a=e.querySelector("#custom-tone-input"),i=e.querySelector("#remove-comment-options");i&&i.remove(),t&&t.remove(),n&&n.remove(),o&&o.remove(),r&&r.remove(),a&&a.remove()})),t&&removePostOptions(),n&&function(){const e=document.querySelector(".msg-form__contenteditable"),t=e.querySelector("#generateTemplateButton"),n=e.querySelector("#templateRequirements"),o=e.querySelector("#templateToneDropdown");t&&t.remove(),n&&n.remove(),o&&o.remove()}()}}))})();